<div class="container" [formGroup]="addUserForm">
  <!-- ===== Header ===== -->
  <div class="title">
    <mat-icon>add_to_photos</mat-icon>
    <h2>Ajouter un article</h2>
  </div>
  <mat-divider></mat-divider>

  <button mat-fab aria-label="Retour" class="back-icon" (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
  </button>

  <!-- ===== Article Info ===== -->
  <div class="user-info">
    <div class="left-div">
      <mat-form-field appearance="outline">
        <mat-label>Référence</mat-label>
        <input matInput formControlName="reference" type="text" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Désignation</mat-label>
        <input matInput formControlName="designation" type="text" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Famille</mat-label>
        <mat-select formControlName="family">
          <mat-option value="0">ACCESSOIRE</mat-option>
          <mat-option value="1">PROFILE</mat-option>
          <mat-option value="2">JOINT</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="right-div">
      <mat-form-field appearance="outline">
        <mat-label>Type</mat-label>
        <mat-select formControlName="type">
          <mat-option value="ml" *ngIf="addUserForm.get('family')?.value != 0">ML</mat-option>
          <mat-option value="unit" *ngIf="addUserForm.get('family')?.value == 0">Unité</mat-option>
          <mat-option value="pair" *ngIf="addUserForm.get('family')?.value == 0">Pair</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" *ngIf="addUserForm.get('family')?.value == 1">
        <mat-label>Longueur</mat-label>
        <input matInput formControlName="longueur" type="number" />
      </mat-form-field>
    </div>
  </div>

  <!-- ===== Colors & Prices Section ===== -->
  <div class="colors-section mt-6" formArrayName="colorPrices">
    <div class="section-header flex items-center justify-between">
      <h3>Couleurs et prix</h3>
      <button mat-mini-fab color="primary" type="button" (click)="addColorPrice()">
        <mat-icon>add</mat-icon>
      </button>
    </div>

    <div
      *ngFor="let group of colorPrices?.controls; let i = index"
      [formGroupName]="i"
      class="color-row flex items-center gap-3 mt-3"
    >
      <mat-form-field appearance="outline" class="w-40">
        <mat-label>Couleur</mat-label>
        <mat-select formControlName="colorId">
          <mat-option *ngFor="let color of colors" [value]="color.id">{{ color.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-40">
        <mat-label>
          {{ addUserForm.get('family')?.value == 1 ? 'Prix Unitaire HT' : 'Prix Total HT' }}
        </mat-label>
        <input matInput type="number" formControlName="prixUnitaireHT" />
      </mat-form-field>

      <button mat-icon-button color="warn" type="button" (click)="removeColorPrice(i)">
        <mat-icon>delete</mat-icon>
      </button>
    </div>

    <p *ngIf="(colorPrices?.controls?.length ?? 0) === 0" class="text-gray-500 mt-4">
      Aucune couleur ajoutée pour le moment.
    </p>
  </div>

  <!-- ===== Actions ===== -->
  <div class="actions mt-6">
    <button class="button" mat-raised-button color="primary" (click)="confirm()" [disabled]="addUserForm.invalid">
      Ajouter
      <mat-icon iconPositionEnd>done</mat-icon>
    </button>
  </div>
</div>
